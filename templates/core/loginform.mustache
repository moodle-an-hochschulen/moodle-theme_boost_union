{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template core/loginform

    Moodle template for the login page.

    Context variables required for this template:
    * autofocusform: Auto focus on form ?,
    * canloginasguest - Is guest login allowed?,
    * canloginbyemail - Is login by email allowed?,
    * cansignup - Signup allowed?,
    * showloginform - Hide the standard login form if it not necessary (only OAuth2 for example)
    * cookieshelpicon - cookies help icon details
    * error - Any errors in the form?,
    * info - Info notification to display,
    * forgotpasswordurl - Forgot password url,
    * hasidentityproviders - Flag, set to true to hide identity providers,
    * hasinstructions - Flag, set to true to show instructions,
    * identityproviders - List of identiy providers,
    * instructions - Instructions,
    * instructionsformat - Format of instructions,
    * loginurl - Login url,
    * signupurl - Signup url,
    * errorformatted - Formatted error,
    * logourl - Flag, logo url,
    * sitename - Name of site.,
    * logintoken - Random token to protect login request.,
    * maintenance - Maintenance message
    * activeaccordionguest - Flag, set to true when guest login accordion is open (accordion layout),
    * activeaccordionidp - Flag, set to true when IDP login accordion is open (accordion layout),
    * activeaccordionlocal - Flag, set to true when local login accordion is open (accordion layout),
    * activeaccordionfirsttimesignup - Flag, set to true when firsttimesignup accordion is open (accordion layout),
    * activetabguest - Flag, set to true when guest login tab is active (tabs layout),
    * activetabidp - Flag, set to true when IDP login tab is active (tabs layout),
    * activetablocal - Flag, set to true when local login tab is active (tabs layout),
    * activetabfirsttimesignup - Flag, set to true when firsttimesignup tab is active (tabs layout),
    * guestloginintrotext - Custom guest login intro text (optional),
    * idploginintrotext - Custom IDP login intro text (optional),
    * info - Info notification to display,
    * languagemenu - Language menu content,
    * localloginintrotext - Custom local login intro text (optional),
    * loginaccordion - Flag used to check if elements should be displayed for the accordion layout type,
    * loginmethods - Array used to iterate over the login methods, each with: id, name, order, type, islocal, isidp, isfirsttimesignup, isguest, isfirst,
    * logintabs - Object used to check if elements should be displayed for the tabs layout type,
    * logourl - Flag, logo url,
    * recaptcha - reCAPTCHA HTML (optional),
    * selfregistrationloginintrotext - Custom self registration intro text (optional),
    * showguestlogin - Should guest login be shown? (theme + core),
    * showguestloginintro - Should the guest login intro be shown?,
    * showidplogin - Should IDP login be shown? (theme + core),
    * showidploginintro - Should the IDP login intro be shown?,
    * showlocallogin - Should the local login form be shown?,
    * showlocalloginintro - Should the local login intro be shown?,
    * showselfregistration - Should self registration be shown? (theme + core),
    * showselfregistrationloginintro - Should the self registration intro be shown?,
    * smallscreensonly - Toggle password visibility only on small screens?,
    * tabs - Array used to iterate over the individual tabs, each with: id, name, displayname, order, content, active,
    * togglepassword - Enable password visibility toggle?,
    * username - Pre-filled username value (optional),


    Example context (json):
    {
        "autofocusform": false,
        "canloginasguest": "1",
        "canloginbyemail": false,
        "cansignup": true,
        "showloginform": true,
        "cookieshelpicon": {
            "heading": "Cookies must be enabled in your browser",
            "text": "<div class=\"no-overflow\">Two cookies are used on this site. Both died..</div>",
            "icon": {
                "attributes": [
                    {
                        "name": "class",
                        "value": ""
                    },
                    {
                        "name": "alt",
                        "value": "Help with Cookies must be enabled in your browser"
                    },
                    {
                        "name": "title",
                        "value": "Help with Cookies must be enabled in your browser"
                    },
                    {
                        "name": "src",
                        "value": "http://localhost/stable_master/theme/image.php?theme=boost&component=core&image=help"
                    }
                ]
            },
            "linktext": null,
            "title": "Help with Cookies must be enabled in your browser",
            "url": "http://localhost/stable_master/help.php?component=core&identifier=cookiesenabled&lang=en",
            "ltr": true
        },
        "error": "",
        "info": "",
        "forgotpasswordurl": "http://localhost/stable_master/login/forgot_password.php",
        "hasidentityproviders": false,
        "hasinstructions": true,
        "identityproviders": [],
        "instructions": "For full access to this site, you first need to create an account.",
        "instructionsformat": "1",
        "loginurl": "http://localhost/stable_master/login/index.php",
        "signupurl": "http://localhost/stable_master/login/signup.php",
        "cookieshelpiconformatted": "",
        "errorformatted": "",
        "logourl": false,
        "sitename": "Beer & Chips",
        "logintoken": "randomstring",
        "maintenance": "For full access to this site, you need to login in as an admin.",
        "languagemenu": "Choose language",
        "togglepassword": true,
        "smallscreensonly": true,
        "activeaccordionguest": false,
        "activeaccordionidp": false,
        "activeaccordionlocal": false,
        "activeaccordionfirsttimesignup": false,
        "activetabguest": false,
        "activetabidp": false,
        "activetablocal": true,
        "activetabfirsttimesignup": false,
        "guestloginintrotext": "",
        "idploginintrotext": "",
        "localloginintrotext": "",
        "loginaccordion": false,
        "loginmethods": [
            {
                "id": "theme_boost_union-loginorder-local",
                "name": "local",
                "order": 1,
                "type": "local",
                "islocal": true,
                "isidp": false,
                "isfirsttimesignup": false,
                "isguest": false,
                "isfirst": true
            },
            {
                "id": "theme_boost_union-loginorder-idp",
                "name": "idp",
                "order": 2,
                "type": "idp",
                "islocal": false,
                "isidp": true,
                "isfirsttimesignup": false,
                "isguest": false,
                "isfirst": false
            }
        ],
        "logintabs": {
            "tabs": [
                {
                    "id": "login-tab-local",
                    "name": "local",
                    "displayname": "Local Login",
                    "order": 1,
                    "content": "local",
                    "active": true
                },
                {
                    "id": "login-tab-idp",
                    "name": "idp",
                    "displayname": "Identity Providers",
                    "order": 2,
                    "content": "idp",
                    "active": false
                }
            ]
        },
        "recaptcha": "",
        "selfregistrationloginintrotext": "",
        "showguestloginintro": false,
        "showidploginintro": true,
        "showlocallogin": true,
        "showlocalloginintro": true,
        "showselfregistrationloginintro": false,
        "username": ""
    }
}}
{{!
    This template is a modified version of core/loginform
    Modifications compared to the original template:
    * Add btn-secondary class to identityprovider login buttons.
    * Added the possibility to change the login method order by adding wrapper divs around each login method.
    * Added the possibility to change the login layout from a vertical to a tabbed layout or accordion layout.
    * Added the possibility to hide each login provider (with Boost Union).
    * Removed the possibility to hide the local login form (with Moodle Core from Moodle 4.5 on).
    * Added the possibility to show or hide the login provider intros.
}}

{{!
    This template supports three layout options (vertical, tabs, accordion) and renders multiple
    login methods (local, IDP, firsttimesignup, guest) in a sorted order. The broad structure of this document
    consists of: Header Section (logo/heading and messages), Container Section (either for tabs layout
    where we iterate over the tabs array, or for vertical/accordion layout), Login Methods Section
    (where we iterate over the loginmethods array to display the actual login forms), Container Close
    Section (to close the container), Footer Section (language menu and cookies notice), and
    JavaScript Section (for form handling and layout-specific functionality).
}}

{{! =========================================================================== }}
{{! HEADER SECTION }}
{{! =========================================================================== }}
<div class="loginform">
    {{#logourl}}
        <div id="loginlogo" class="login-logo">
            <img id="logoimage" src="{{logourl}}" class="img-fluid" alt="{{sitename}}"/>
            <h1 class="login-heading visually-hidden">{{#str}} loginto, core, {{sitename}} {{/str}}</h1>
        </div>
    {{/logourl}}
    {{^logourl}}
        <h1 class="login-heading mb-4">{{#str}} loginto, core, {{sitename}} {{/str}}</h1>
    {{/logourl}}

    {{! Messages: Maintenance, Error, Info }}
    {{#maintenance}}
        <div class="alert alert-danger login-maintenance">
            {{{maintenance}}}
        </div>
    {{/maintenance}}
    {{#error}}
        <div class="alert alert-danger" id="loginerrormessage" role="alert">{{error}}</div>
    {{/error}}
    {{#info}}
        <div class="alert alert-info" id="logininfomessage" role="status">{{info}}</div>
    {{/info}}

    {{! =========================================================================== }}
    {{! LAYOUT CONTAINER: Tabs or Vertical/Accordion }}
    {{! =========================================================================== }}
    {{#logintabs}}
    {{! Tabs Layout: Navigation and content }}
    <ul class="nav nav-tabs mb-4" id="login-tabs" role="tablist">
        {{#tabs}}
        <li class="nav-item" role="presentation">
            <a class="nav-link {{#active}}active{{/active}}" id="{{id}}-tab" data-bs-toggle="tab" href="#{{id}}" role="tab" aria-controls="{{id}}" {{#active}}aria-selected="true"{{/active}}{{^active}}aria-selected="false" tabindex="-1"{{/active}}>{{displayname}}</a>
        </li>
        {{/tabs}}
    </ul>
    <div class="tab-content mb-4" id="login-tabs-content">
    {{/logintabs}}
    {{^logintabs}}
    {{! Vertical/Accordion Layout: Container }}
    <div id="theme_boost_union-loginorder" class="login-layout-vertical {{#loginaccordion}}login-layout-accordion accordion{{/loginaccordion}}">
    {{/logintabs}}

    {{! =========================================================================== }}
    {{! LOGIN METHODS: Loop through sorted methods }}
    {{! =========================================================================== }}
    {{#loginmethods}}

    {{! --------------------------------------------------------------------------- }}
    {{! METHOD: Local Login (Username/Password) }}
    {{! --------------------------------------------------------------------------- }}
    {{#islocal}}
    {{#showlocallogin}}
    <div {{#logintabs}}id="login-tab-local"{{/logintabs}}{{^logintabs}}id="{{id}}"{{/logintabs}} class="theme_boost_union-loginmethod {{#logintabs}}tab-pane fade{{#activetablocal}} show active{{/activetablocal}}{{/logintabs}} {{#loginaccordion}}accordion-item{{/loginaccordion}}" {{#logintabs}}role="tabpanel" aria-labelledby="login-tab-local-tab"{{/logintabs}}>

        {{! Divider for vertical layout only (skip first method) }}
        {{^logintabs}}
        {{^loginaccordion}}
        {{^isfirst}}
        <div class="login-divider"></div>
        {{/isfirst}}
        {{/loginaccordion}}
        {{/logintabs}}

        {{! Accordion header }}
        {{#loginaccordion}}
        <h2 class="accordion-header" id="accordion-local-header">
            <button class="accordion-button {{^activeaccordionlocal}}collapsed{{/activeaccordionlocal}}" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-local-content" {{#activeaccordionlocal}}aria-expanded="true"{{/activeaccordionlocal}}{{^activeaccordionlocal}}aria-expanded="false"{{/activeaccordionlocal}} aria-controls="accordion-local-content">
                <span class="login-heading text-break w-100">{{label}}</span>
            </button>
        </h2>
        <div id="accordion-local-content" class="accordion-collapse collapse {{#activeaccordionlocal}}show{{/activeaccordionlocal}}" aria-labelledby="accordion-local-header" data-bs-parent="{{#loginaccordion}}#theme_boost_union-loginorder{{/loginaccordion}}">
        <div class="accordion-body">
        {{#showlocalloginintro}}
        <h2 class="login-heading text-break w-100">{{#localloginintrotext}}{{{localloginintrotext}}}{{/localloginintrotext}}{{^localloginintrotext}}{{#str}} loginlocalintro, theme_boost_union {{/str}}{{/localloginintrotext}}</h2>
        {{/showlocalloginintro}}
        {{/loginaccordion}}

        {{! Intro heading for vertical layout only }}
        {{^loginaccordion}}
        {{#showlocalloginintro}}
        <h2 class="login-heading">{{#localloginintrotext}}{{{localloginintrotext}}}{{/localloginintrotext}}{{^localloginintrotext}}{{#str}} loginlocalintro, theme_boost_union {{/str}}{{/localloginintrotext}}</h2>
        {{/showlocalloginintro}}
        {{/loginaccordion}}

        {{! Login form }}
        <form class="login-form" action="{{loginurl}}" method="post" id="login">
            <input id="anchor" type="hidden" name="anchor" value="">
            <script>document.getElementById('anchor').value = location.hash;</script>
            <input type="hidden" name="logintoken" value="{{logintoken}}">
            <div class="login-form-username mb-3">
                <label for="username" class="visually-hidden">
                    {{^canloginbyemail}}
                        {{#str}} username {{/str}}
                    {{/canloginbyemail}}
                    {{#canloginbyemail}}
                        {{#str}} usernameemail {{/str}}
                    {{/canloginbyemail}}
                </label>
                <input type="text" name="username" id="username" {{!
                    !}}class="form-control form-control-lg" {{!
                    !}}value="{{username}}" {{!
                    !}}placeholder="{{^canloginbyemail}}{{#cleanstr}}username{{/cleanstr}}{{/canloginbyemail}}{{!
                    !}}{{#canloginbyemail}}{{#cleanstr}}usernameemail{{/cleanstr}}{{/canloginbyemail}}" {{!
                    !}}autocomplete="username">
            </div>
            <div class="login-form-password mb-3">
                <label for="password" class="visually-hidden">{{#str}} password {{/str}}</label>
                <input type="password" name="password" id="password" value="" {{!
                    !}}class="form-control form-control-lg" {{!
                    !}}placeholder="{{#cleanstr}}password{{/cleanstr}}" {{!
                    !}}autocomplete="current-password">
            </div>
            {{#recaptcha}}
                <div class="login-form-recaptcha mb-3">
                    {{{recaptcha}}}
                </div>
            {{/recaptcha}}
            <div class="login-form-submit mb-3">
                <button class="btn btn-primary btn-lg" type="submit" id="loginbtn">{{#str}}login{{/str}}</button>
            </div>
            <div class="login-form-forgotpassword mb-3">
                <a href="{{forgotpasswordurl}}">{{#str}}forgotaccount{{/str}}</a>
            </div>
        </form>

        {{! Close accordion structure }}
        {{#loginaccordion}}
        </div>
        </div>
        {{/loginaccordion}}
    </div>
    {{/showlocallogin}}
    {{/islocal}}

    {{! --------------------------------------------------------------------------- }}
    {{! METHOD: Identity Providers (OAuth2, SAML, etc.) }}
    {{! --------------------------------------------------------------------------- }}
    {{#isidp}}
    {{#showidplogin}}
    <div {{#logintabs}}id="login-tab-idp"{{/logintabs}}{{^logintabs}}id="{{id}}"{{/logintabs}} class="theme_boost_union-loginmethod {{#logintabs}}tab-pane fade{{#activetabidp}} show active{{/activetabidp}}{{/logintabs}} {{#loginaccordion}}accordion-item{{/loginaccordion}}" {{#logintabs}}role="tabpanel" aria-labelledby="login-tab-idp-tab"{{/logintabs}}>

        {{! Divider for vertical layout only (skip first method) }}
        {{^logintabs}}
        {{^loginaccordion}}
        {{^isfirst}}
        <div class="login-divider"></div>
        {{/isfirst}}
        {{/loginaccordion}}
        {{/logintabs}}

        {{! Accordion header }}
        {{#loginaccordion}}
        <h2 class="accordion-header" id="accordion-idp-header">
            <button class="accordion-button {{^activeaccordionidp}}collapsed{{/activeaccordionidp}}" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-idp-content" {{#activeaccordionidp}}aria-expanded="true"{{/activeaccordionidp}}{{^activeaccordionidp}}aria-expanded="false"{{/activeaccordionidp}} aria-controls="accordion-idp-content">
                <span class="login-heading text-break w-100">{{label}}</span>
            </button>
        </h2>
        <div id="accordion-idp-content" class="accordion-collapse collapse {{#activeaccordionidp}}show{{/activeaccordionidp}}" aria-labelledby="accordion-idp-header" data-bs-parent="{{#loginaccordion}}#theme_boost_union-loginorder{{/loginaccordion}}">
        <div class="accordion-body">
        {{#showidploginintro}}
        <h2 class="login-heading text-break w-100">{{#idploginintrotext}}{{{idploginintrotext}}}{{/idploginintrotext}}{{^idploginintrotext}}{{#str}} potentialidps, auth {{/str}}{{/idploginintrotext}}</h2>
        {{/showidploginintro}}
        {{/loginaccordion}}

        {{! Identity provider buttons }}
        <div class="login-identityproviders">

            {{! Intro heading for vertical layout only }}
            {{^loginaccordion}}
            {{#showidploginintro}}
            <h2 class="login-heading">{{#idploginintrotext}}{{{idploginintrotext}}}{{/idploginintrotext}}{{^idploginintrotext}}{{#str}} potentialidps, auth {{/str}}{{/idploginintrotext}}</h2>
            {{/showidploginintro}}
            {{/loginaccordion}}

            {{#identityproviders}}
                <a class="btn login-identityprovider-btn w-100 btn-secondary" href="{{url}}">
                    {{#iconurl}}
                        <img src="{{iconurl}}" alt="" width="24" height="24"/>
                    {{/iconurl}}
                    {{name}}
                </a>
            {{/identityproviders}}
        </div>

        {{! Close accordion structure }}
        {{#loginaccordion}}
        </div>
        </div>
        {{/loginaccordion}}
    </div>
    {{/showidplogin}}
    {{/isidp}}

    {{! --------------------------------------------------------------------------- }}
    {{! METHOD: Signup / First Time User }}
    {{! --------------------------------------------------------------------------- }}
    {{#isfirsttimesignup}}
    {{#showselfregistration}}
    <div {{#logintabs}}id="login-tab-firsttimesignup"{{/logintabs}}{{^logintabs}}id="{{id}}"{{/logintabs}} class="theme_boost_union-loginmethod {{#logintabs}}tab-pane fade{{#activetabfirsttimesignup}} show active{{/activetabfirsttimesignup}}{{/logintabs}} {{#loginaccordion}}accordion-item{{/loginaccordion}}" {{#logintabs}}role="tabpanel" aria-labelledby="login-tab-firsttimesignup-tab"{{/logintabs}}>

        {{! Divider for vertical layout only (skip first method) }}
        {{^logintabs}}
        {{^loginaccordion}}
        {{^isfirst}}
        <div class="login-divider"></div>
        {{/isfirst}}
        {{/loginaccordion}}
        {{/logintabs}}

        {{! Accordion header }}
        {{#loginaccordion}}
        <h2 class="accordion-header" id="accordion-firsttimesignup-header">
            <button class="accordion-button {{^activeaccordionfirsttimesignup}}collapsed{{/activeaccordionfirsttimesignup}}" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-firsttimesignup-content" {{#activeaccordionfirsttimesignup}}aria-expanded="true"{{/activeaccordionfirsttimesignup}}{{^activeaccordionfirsttimesignup}}aria-expanded="false"{{/activeaccordionfirsttimesignup}} aria-controls="accordion-firsttimesignup-content">
                <span class="login-heading text-break w-100">{{label}}</span>
            </button>
        </h2>
        <div id="accordion-firsttimesignup-content" class="accordion-collapse collapse {{#activeaccordionfirsttimesignup}}show{{/activeaccordionfirsttimesignup}}" aria-labelledby="accordion-firsttimesignup-header" data-bs-parent="{{#loginaccordion}}#theme_boost_union-loginorder{{/loginaccordion}}">
        <div class="accordion-body">
        {{#showselfregistrationloginintro}}
        <h2 class="login-heading text-break w-100">{{#selfregistrationloginintrotext}}{{{selfregistrationloginintrotext}}}{{/selfregistrationloginintrotext}}{{^selfregistrationloginintrotext}}{{#str}}firsttime{{/str}}{{/selfregistrationloginintrotext}}</h2>
        {{/showselfregistrationloginintro}}
        {{/loginaccordion}}

        {{! Instructions and intro for vertical layout only }}
    {{#hasinstructions}}
        <div class="login-instructions {{#cansignup}}mb-3{{/cansignup}}">
            {{^loginaccordion}}
            {{#showselfregistrationloginintro}}
            <h2 class="login-heading">{{#selfregistrationloginintrotext}}{{{selfregistrationloginintrotext}}}{{/selfregistrationloginintrotext}}{{^selfregistrationloginintrotext}}{{#str}}firsttime{{/str}}{{/selfregistrationloginintrotext}}</h2>
            {{/showselfregistrationloginintro}}
            {{/loginaccordion}}
            {{{instructions}}}
        </div>
    {{/hasinstructions}}
    {{^hasinstructions}}
    {{^loginaccordion}}
    {{#showselfregistrationloginintro}}
        <div class="login-instructions {{#cansignup}}mb-3{{/cansignup}}">
            <h2 class="login-heading">{{#selfregistrationloginintrotext}}{{{selfregistrationloginintrotext}}}{{/selfregistrationloginintrotext}}{{^selfregistrationloginintrotext}}{{#str}}firsttime{{/str}}{{/selfregistrationloginintrotext}}</h2>
        </div>
    {{/showselfregistrationloginintro}}
    {{/loginaccordion}}
    {{/hasinstructions}}

        {{! Signup button }}
        <div class="login-signup">
            <a class="btn btn-secondary" href="{{signupurl}}">{{#str}}startsignup{{/str}}</a>
        </div>

        {{! Close accordion structure }}
        {{#loginaccordion}}
        </div>
        </div>
        {{/loginaccordion}}
    </div>
    {{/showselfregistration}}
    {{/isfirsttimesignup}}

    {{! --------------------------------------------------------------------------- }}
    {{! METHOD: Guest Login }}
    {{! --------------------------------------------------------------------------- }}
    {{#isguest}}
    {{#showguestlogin}}
    <div {{#logintabs}}id="login-tab-guest"{{/logintabs}}{{^logintabs}}id="{{id}}"{{/logintabs}} class="theme_boost_union-loginmethod {{#logintabs}}tab-pane fade{{#activetabguest}} show active{{/activetabguest}}{{/logintabs}} {{#loginaccordion}}accordion-item{{/loginaccordion}}" {{#logintabs}}role="tabpanel" aria-labelledby="login-tab-guest-tab"{{/logintabs}}>

        {{! Divider for vertical layout only (skip first method) }}
        {{^logintabs}}
        {{^loginaccordion}}
        {{^isfirst}}
        <div class="login-divider"></div>
        {{/isfirst}}
        {{/loginaccordion}}
        {{/logintabs}}

        {{! Accordion header }}
        {{#loginaccordion}}
        <h2 class="accordion-header" id="accordion-guest-header">
            <button class="accordion-button {{^activeaccordionguest}}collapsed{{/activeaccordionguest}}" type="button" data-bs-toggle="collapse" data-bs-target="#accordion-guest-content" {{#activeaccordionguest}}aria-expanded="true"{{/activeaccordionguest}}{{^activeaccordionguest}}aria-expanded="false"{{/activeaccordionguest}} aria-controls="accordion-guest-content">
                <span class="login-heading text-break w-100">{{label}}</span>
            </button>
        </h2>
        <div id="accordion-guest-content" class="accordion-collapse collapse {{#activeaccordionguest}}show{{/activeaccordionguest}}" aria-labelledby="accordion-guest-header" data-bs-parent="{{#loginaccordion}}#theme_boost_union-loginorder{{/loginaccordion}}">
        <div class="accordion-body">
        {{#showguestloginintro}}
        <h2 class="login-heading text-break w-100">{{#guestloginintrotext}}{{{guestloginintrotext}}}{{/guestloginintrotext}}{{^guestloginintrotext}}{{#str}}someallowguest{{/str}}{{/guestloginintrotext}}</h2>
        {{/showguestloginintro}}
        {{/loginaccordion}}

        {{! Intro heading for vertical layout only }}
        {{^loginaccordion}}
        {{#showguestloginintro}}
        <h2 class="login-heading">{{#guestloginintrotext}}{{{guestloginintrotext}}}{{/guestloginintrotext}}{{^guestloginintrotext}}{{#str}}someallowguest{{/str}}{{/guestloginintrotext}}</h2>
        {{/showguestloginintro}}
        {{/loginaccordion}}

        {{! Guest login form }}
        <form action="{{loginurl}}" method="post" id="guestlogin">
            <input type="hidden" name="logintoken" value="{{logintoken}}">
            <input type="hidden" name="username" value="guest" />
            <input type="hidden" name="password" value="guest" />
            <button class="btn btn-secondary" type="submit" id="loginguestbtn">{{#str}}loginguest{{/str}}</button>
        </form>

        {{! Close accordion structure }}
        {{#loginaccordion}}
        </div>
        </div>
        {{/loginaccordion}}
    </div>
    {{/showguestlogin}}
    {{/isguest}}
    {{/loginmethods}}

    {{! =========================================================================== }}
    {{! CLOSE LAYOUT CONTAINER }}
    {{! =========================================================================== }}
    {{#logintabs}}
    </div>
    {{! Divider after tabs content }}
    <div class="login-divider"></div>
    {{/logintabs}}
    {{^logintabs}}
    </div>
    {{! Final divider for vertical/accordion layout }}
    <div class="login-divider"></div>
    {{/logintabs}}

    {{! =========================================================================== }}
    {{! FOOTER: Language menu and cookies notice }}
    {{! =========================================================================== }}
    <div class="d-flex">
        {{#languagemenu}}
            <div class="login-languagemenu">
                {{>core/action_menu}}
            </div>
            <div class="divider border-start align-self-center mx-3"></div>
        {{/languagemenu}}
        <button type="button" class="btn btn-secondary" {{!
        }} data-modal="alert"{{!
        }} data-modal-title-str='["cookiesenabled", "core"]' {{!
        }} data-modal-content-str='["cookiesenabled_help_html", "core"]'{{!
        }}>{{#str}}cookiesnotice{{/str}}</button>
    </div>
</div>

{{! =========================================================================== }}
{{! JAVASCRIPT }}
{{! =========================================================================== }}
{{#js}}
    {{! Auto-focus form fields }}
    {{^error}}
        {{#autofocusform}}
            require(['core_form/events'], function(FormEvent) {
                function autoFocus() {
                    const userNameField = document.getElementById('username');
                    const passwordField = document.getElementById('password');
                    if (userNameField && userNameField.value.length == 0) {
                        userNameField.focus();
                    } else if (passwordField) {
                        passwordField.focus();
                    }
                }
                autoFocus();
                window.addEventListener(FormEvent.eventTypes.fieldStructureChanged, autoFocus);
            });
        {{/autofocusform}}
    {{/error}}

    {{! Handle error/info messages and focus }}
    require(['core/pending'], function(Pending) {
        const errorMessageDiv = document.getElementById('loginerrormessage');
        const infoMessageDiv = document.getElementById('logininfomessage');
        const errorMessage = errorMessageDiv?.textContent.trim();
        const infoMessage = infoMessageDiv?.textContent.trim();
        if (errorMessage || infoMessage) {
            const pendingJS = new Pending('login-move-focus');
            const usernameField = document.getElementById('username');
            setTimeout(function() {
                if (errorMessage && usernameField) {
                    usernameField.focus();
                }
                if (errorMessage) {
                    errorMessageDiv.innerHTML += "&nbsp;";
                }
                if (infoMessage) {
                    infoMessageDiv.innerHTML += "&nbsp;";
                }
                pendingJS.resolve();
            }, 500);
        }
    });

    {{! Password visibility toggle }}
    {{#togglepassword}}
        require(['core/togglesensitive'], function(ToggleSensitive) {
            ToggleSensitive.init("password", {{smallscreensonly}});
        });
    {{/togglepassword}}

    {{! Form submission handling }}
    require(['core_form/submit'], function(Submit) {
        Submit.init("loginbtn");
        {{#showguestlogin}}
            Submit.init("loginguestbtn");
        {{/showguestlogin}}
    });

    {{! Tabs layout: Clear URL hash }}
    {{#logintabs}}
    (function() {
        if (window.location.hash && (window.location.hash.indexOf('login-tab') !== -1 || window.location.hash.indexOf('login-') !== -1)) {
            history.replaceState(null, null, window.location.pathname + window.location.search);
        }
    })();
    {{/logintabs}}
{{/js}}
