{"version":3,"file":"section-summary.min.js","sources":["../../src/course_format/section-summary.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Union - JS for topics course format addition to realize always visible section summary.\n *\n * @module     theme_boost_union/section-summary\n * @copyright  2023 Mario Wehr <m.wehr@fh-kaernten.at>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\n\nconst MOVE_DIRECTION = {\n    MOVE_IN: 'move-in',\n    MOVE_OUT: 'move-out'\n};\n\n// 1 Rem [px] - https://stackoverflow.com/questions/36532307/rem-px-in-javascript\nconst OneRem = parseFloat(getComputedStyle(document.documentElement).fontSize); // Used for mimic parent mb-3, .my-3 .\n\n/**\n * Calculate height of hidden summary item\n * @param {HTMLElement} collapse\n * @param {HTMLElement} courseDescItem\n * @returns {number} height\n */\nfunction calculateHeight(collapse, courseDescItem) {\n    collapse.classList.add('calc-height');\n    let height = courseDescItem.scrollHeight + OneRem;\n    collapse.classList.remove('calc-height');\n    return height;\n}\n\n/**\n * @param {HTMLElement} contentCollapse\n * @param {null|number} height\n * @param {null|number} minHeight\n */\nfunction setCollapseStyles(contentCollapse, height, minHeight = null) {\n    contentCollapse.style.overflow = 'hidden';\n    if (height) {\n        contentCollapse.classList.remove(\"collapse\");\n        contentCollapse.style.height = height + 'px';\n    }\n    if (minHeight) {\n        contentCollapse.style.minHeight = height + 'px';\n    }\n}\n\n/**\n * @param {HTMLElement} courseDescItem\n * @param {string} from\n * @param {string} to\n */\nfunction indentSummary(courseDescItem, from, to) {\n    courseDescItem.classList.remove(from);\n    courseDescItem.classList.add(to);\n}\n\n/**\n * Responsible for moving summary information to inner <-> outer place and limit collapse to summary content height.\n */\nclass SummaryItemController {\n    constructor(sectionCollapse, sectionSummary, sectionContent) {\n        this.contentCollapse = sectionCollapse;\n        this.sectionContent = sectionContent;\n        this.sectionSummary = sectionSummary;\n        this.height = 0;\n\n        // Check if we start collapsed.\n        if (!this.contentCollapse.classList.contains(\"show\")) {\n            this.height = calculateHeight(this.contentCollapse, this.sectionSummary);\n            this.sectionContent.setAttribute('style', 'display:none !important');\n            setCollapseStyles(this.contentCollapse, this.height);\n            indentSummary(this.sectionSummary, MOVE_DIRECTION.MOVE_OUT, MOVE_DIRECTION.MOVE_IN);\n        }\n\n        $(this.contentCollapse).on('hide.bs.collapse', () => {\n            this.height = this.sectionSummary.offsetHeight + OneRem;\n            indentSummary(this.sectionSummary, MOVE_DIRECTION.MOVE_OUT, MOVE_DIRECTION.MOVE_IN);\n            this.contentCollapse.style.minHeight = this.height + 'px';\n        });\n\n        $(this.contentCollapse).on('hidden.bs.collapse', () => {\n            this.sectionContent.setAttribute('style', 'display:none !important');\n            setCollapseStyles(this.contentCollapse, this.height);\n        });\n\n        $(this.contentCollapse).on('shown.bs.collapse', () => {\n            this.height = this.sectionSummary.offsetHeight + OneRem;\n            setCollapseStyles(this.contentCollapse, null, this.height);\n        });\n\n        $(this.contentCollapse).on('show.bs.collapse', () => {\n            this.sectionContent.style.removeProperty('display');\n            indentSummary(this.sectionSummary, MOVE_DIRECTION.MOVE_IN, MOVE_DIRECTION.MOVE_OUT);\n        });\n\n    }\n}\n\nexport const init = () => {\n    const sectionList = document.querySelectorAll('ul.topics li.section.course-section, ul.weeks li.section.course-section');\n    const summaryCtrlList = new Array(sectionList.length);\n    for (let idx = 0; idx < sectionList.length; idx++) {\n        const section = sectionList[idx];\n        const sectionCollapse = section.querySelector('.course-content-item-content');\n        if (sectionCollapse) {\n            const sectionSummary = sectionCollapse.querySelector('.summarytext');\n            // Only create SummaryItemController if summary content is present.\n            if (sectionSummary) {\n                summaryCtrlList[idx] = new SummaryItemController(\n                    sectionCollapse,\n                    sectionSummary,\n                    sectionCollapse.querySelector('ul.section')\n                );\n            }\n        }\n    }\n};\n"],"names":["MOVE_DIRECTION","OneRem","parseFloat","getComputedStyle","document","documentElement","fontSize","setCollapseStyles","contentCollapse","height","minHeight","style","overflow","classList","remove","indentSummary","courseDescItem","from","to","add","SummaryItemController","constructor","sectionCollapse","sectionSummary","sectionContent","this","contains","collapse","scrollHeight","calculateHeight","setAttribute","on","offsetHeight","removeProperty","sectionList","querySelectorAll","summaryCtrlList","Array","length","idx","querySelector"],"mappings":";;;;;;;gJAyBMA,uBACO,UADPA,wBAEQ,WAIRC,OAASC,WAAWC,iBAAiBC,SAASC,iBAAiBC,mBAoB5DC,kBAAkBC,gBAAiBC,YAAQC,iEAAY,KAC5DF,gBAAgBG,MAAMC,SAAW,SAC7BH,SACAD,gBAAgBK,UAAUC,OAAO,YACjCN,gBAAgBG,MAAMF,OAASA,OAAS,MAExCC,YACAF,gBAAgBG,MAAMD,UAAYD,OAAS,eAS1CM,cAAcC,eAAgBC,KAAMC,IACzCF,eAAeH,UAAUC,OAAOG,MAChCD,eAAeH,UAAUM,IAAID,UAM3BE,sBACFC,YAAYC,gBAAiBC,eAAgBC,qBACpChB,gBAAkBc,qBAClBE,eAAiBA,oBACjBD,eAAiBA,oBACjBd,OAAS,EAGTgB,KAAKjB,gBAAgBK,UAAUa,SAAS,eACpCjB,gBA7CQkB,SAAUX,gBAC/BW,SAASd,UAAUM,IAAI,mBACnBV,OAASO,eAAeY,aAAe3B,cAC3C0B,SAASd,UAAUC,OAAO,eACnBL,OAyCeoB,CAAgBJ,KAAKjB,gBAAiBiB,KAAKF,qBACpDC,eAAeM,aAAa,QAAS,2BAC1CvB,kBAAkBkB,KAAKjB,gBAAiBiB,KAAKhB,QAC7CM,cAAcU,KAAKF,eAAgBvB,wBAAyBA,6CAG9DyB,KAAKjB,iBAAiBuB,GAAG,oBAAoB,UACtCtB,OAASgB,KAAKF,eAAeS,aAAe/B,OACjDc,cAAcU,KAAKF,eAAgBvB,wBAAyBA,6BACvDQ,gBAAgBG,MAAMD,UAAYe,KAAKhB,OAAS,4BAGvDgB,KAAKjB,iBAAiBuB,GAAG,sBAAsB,UACxCP,eAAeM,aAAa,QAAS,2BAC1CvB,kBAAkBkB,KAAKjB,gBAAiBiB,KAAKhB,+BAG/CgB,KAAKjB,iBAAiBuB,GAAG,qBAAqB,UACvCtB,OAASgB,KAAKF,eAAeS,aAAe/B,OACjDM,kBAAkBkB,KAAKjB,gBAAiB,KAAMiB,KAAKhB,+BAGrDgB,KAAKjB,iBAAiBuB,GAAG,oBAAoB,UACtCP,eAAeb,MAAMsB,eAAe,WACzClB,cAAcU,KAAKF,eAAgBvB,uBAAwBA,2CAMnD,WACVkC,YAAc9B,SAAS+B,iBAAiB,2EACxCC,gBAAkB,IAAIC,MAAMH,YAAYI,YACzC,IAAIC,IAAM,EAAGA,IAAML,YAAYI,OAAQC,MAAO,OAEzCjB,gBADUY,YAAYK,KACIC,cAAc,mCAC1ClB,gBAAiB,OACXC,eAAiBD,gBAAgBkB,cAAc,gBAEjDjB,iBACAa,gBAAgBG,KAAO,IAAInB,sBACvBE,gBACAC,eACAD,gBAAgBkB,cAAc"}