{"version":3,"file":"fontawesome-popover.min.js","sources":["../src/fontawesome-popover.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\r\n//\r\n// Moodle is free software: you can redistribute it and/or modify\r\n// it under the terms of the GNU General Public License as published by\r\n// the Free Software Foundation, either version 3 of the License, or\r\n// (at your option) any later version.\r\n//\r\n// Moodle is distributed in the hope that it will be useful,\r\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n// GNU General Public License for more details.\r\n//\r\n// You should have received a copy of the GNU General Public License\r\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\r\n\r\n/**\r\n * Shows the footer content in a popover. Modified version of theme_boost\\footer-popover by Bas Brands\r\n *\r\n * @module     theme_boost_union/fontawesome-popover\r\n * @copyright  bdecent GmbH 2023\r\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\r\n */\r\n\r\ndefine(['jquery', 'theme_boost/popover', 'core/fragment'], function($, popover, Fragment) {\r\n\r\n    const SELECTORS = {\r\n        PICKERCONTAINER: '.fontawesome-iconpicker-popover',\r\n        PICKERCONTENT: '[data-region=\"icons-list\"]',\r\n    };\r\n\r\n    var contextID;\r\n\r\n    let pickerIsShown = false;\r\n\r\n    var SELECTBOX;\r\n\r\n    /**\r\n     * Get the footer content for popover.\r\n     *\r\n     * @returns {String} HTML string\r\n     * @private\r\n     */\r\n    const getIconList = () => {\r\n        return Fragment.loadFragment('theme_boost_union', 'icons_list', contextID, {});\r\n    };\r\n\r\n    /**\r\n     * Filter the icons in list with values user entered in search input.\r\n     * Given input will contain the text in both aria-value and aria-label.\r\n     * Ex. \"core:t\\document\" is aira value and \"fa-document\" is aria-label.\r\n     *\r\n     * @param {Element} target\r\n     */\r\n    const filterIcons = (target) => {\r\n        var filter = target.value.toLowerCase();\r\n        SELECTBOX.value = filter || 0;\r\n        var ul = document.querySelector('.fontawesome-iconpicker-popover ul.fontawesome-icon-suggestions');\r\n        if (ul === undefined || ul === null) {\r\n            return;\r\n        }\r\n        var li = ul.querySelectorAll('li');\r\n\r\n        for (var i = 0; i < li.length; i++) {\r\n            var value = li[i].getAttribute('aria-value');\r\n            var label = li[i].getAttribute('aria-label');\r\n            if (!value.toLowerCase().includes(filter) && !label.toLowerCase().includes(filter)) {\r\n                li[i].style.display = \"none\";\r\n            } else {\r\n                li[i].style.display = \"inline-block\";\r\n            }\r\n        }\r\n    };\r\n\r\n    /**\r\n     * Creates input element and append the element into the target elements parentnode.\r\n     * USer can able to search icons using this input field\r\n     *\r\n     * @param {String} target Element Selector.\r\n     */\r\n    const createElements = (target) => {\r\n\r\n        var input = document.createElement('input');\r\n        input.setAttribute('type', 'text');\r\n        input.classList.add('fontawesome-autocomplete');\r\n        input.classList.add('form-control');\r\n        input.setAttribute('name', 'iconsearch');\r\n\r\n        if (SELECTBOX.value != '') {\r\n            input.value = SELECTBOX.querySelector('option[selected]') !== null\r\n                ? SELECTBOX.querySelector('option[selected]').text : '';\r\n        }\r\n\r\n        var wrapper = document.createElement('div');\r\n        wrapper.classList.add(\"fontawesome-picker-container\");\r\n        wrapper.append(input);\r\n\r\n        document.querySelector(target).style.display = 'none';\r\n        document.querySelector(target).parentNode.append(wrapper);\r\n    };\r\n\r\n    /**\r\n     * Update the target with fontawesome iconpicker.\r\n     *\r\n     * Create picker input field for search icons insert to dom, Fetch the icons list and setup the popover with icons content.\r\n     * Display the popover when the icon search input field is focused or clicked. This way user can view the list of icons,\r\n     * Search icons. when the icons is selected, same icon in the select element will selected.\r\n     *\r\n     * @param {String} target Element Selector.\r\n     */\r\n    const iconPicker = (target) => {\r\n\r\n        SELECTBOX = document.querySelector(target);\r\n\r\n        if (SELECTBOX === undefined || SELECTBOX === null) {\r\n            return;\r\n        }\r\n\r\n        // Create input element and insert for search icons and hide the current target select box.\r\n        createElements(target);\r\n\r\n        // Parent of the target element.\r\n        var selectBoxParent = document.querySelector(target).parentNode;\r\n        // Input element for search icons, appended in createElements method.\r\n        const pickerInput = selectBoxParent.querySelector(\"input.fontawesome-autocomplete\");\r\n\r\n        // Check the search input created and inserted in dom.\r\n        if (pickerInput === undefined || pickerInput === null) {\r\n            setTimeout(() => iconPicker(target), 1000);\r\n            return;\r\n        }\r\n\r\n        // Fetch the icons list, and setup popover with iconslist.\r\n        getIconList().then(function(html) {\r\n\r\n            $(pickerInput).popover({\r\n                content: html,\r\n                html: true,\r\n                placement: 'bottom',\r\n                customClass: 'fontawesome-picker',\r\n                trigger: 'click'\r\n            });\r\n\r\n            // Event observer when the popover is inserted in dom, create eventlistner for each icons in icons list.\r\n            // Icon is clicked, set the icon aria-value as value for select box.\r\n            // Set the icon label to value of autocompletd picker.\r\n            $(pickerInput).on('inserted.bs.popover', function() {\r\n                var ul = document.querySelector('.fontawesome-iconpicker-popover ul.fontawesome-icon-suggestions');\r\n                ul.querySelectorAll('li').forEach((li) => {\r\n                    li.addEventListener('click', (e) => {\r\n                        var target = e.target.closest('li');\r\n                        var value = target.getAttribute('aria-value');\r\n                        var label = target.getAttribute('aria-label');\r\n                        pickerInput.value = label;\r\n                        SELECTBOX.value = value || 0;\r\n                        $(pickerInput).popover('hide');\r\n                    });\r\n                });\r\n            });\r\n            return;\r\n        }).catch();\r\n\r\n        document.addEventListener('click', e => {\r\n            if (pickerIsShown && !e.target.closest(SELECTORS.PICKERCONTAINER)) {\r\n                $(pickerInput).popover('hide');\r\n            }\r\n        },\r\n        true);\r\n\r\n        document.addEventListener('keydown', e => {\r\n            if (pickerIsShown && e.key === 'Escape') {\r\n                $(pickerInput).popover('hide');\r\n                pickerInput.focus();\r\n            }\r\n        });\r\n\r\n        document.addEventListener('focus', e => {\r\n            if (pickerIsShown && !e.target.closest(SELECTORS.PICKERCONTAINER)) {\r\n                $(pickerInput).popover('hide');\r\n            }\r\n        },\r\n        true);\r\n\r\n        $(pickerInput).on('shown.bs.popover', () => {\r\n            pickerIsShown = true;\r\n            // Add class to selected icon, helps to differenciate.\r\n            if (pickerInput.value != '') {\r\n                var iconSuggestion = document.querySelector('.fontawesome-iconpicker-popover ul.fontawesome-icon-suggestions');\r\n                if (iconSuggestion.querySelector('li[aria-label=\"' + pickerInput.value + '\"]') !== null) {\r\n                    // Remove selected class.\r\n                    iconSuggestion.querySelectorAll('li').forEach((li) => li.classList.remove('selected'));\r\n                    // Assign selected class for new.\r\n                    iconSuggestion.querySelector('li[aria-label=\"' + pickerInput.value + '\"]').classList.add('selected');\r\n                }\r\n            }\r\n        });\r\n\r\n        $(pickerInput).on('hide.bs.popover', () => {\r\n            pickerIsShown = false;\r\n        });\r\n\r\n        pickerInput.addEventListener('keyup', function(e) {\r\n            filterIcons(e.target);\r\n        });\r\n\r\n    };\r\n\r\n    return {\r\n        init: (target, contextid) => {\r\n            contextID = contextid;\r\n            iconPicker(target);\r\n        }\r\n\r\n    };\r\n});\r\n"],"names":["define","$","popover","Fragment","SELECTORS","contextID","pickerIsShown","SELECTBOX","iconPicker","target","document","querySelector","input","createElement","setAttribute","classList","add","value","text","wrapper","append","style","display","parentNode","createElements","pickerInput","loadFragment","then","html","content","placement","customClass","trigger","on","querySelectorAll","forEach","li","addEventListener","e","closest","getAttribute","label","catch","key","focus","iconSuggestion","remove","filter","toLowerCase","ul","i","length","includes","filterIcons","setTimeout","init","contextid"],"mappings":"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"}