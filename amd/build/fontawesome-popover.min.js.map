{"version":3,"file":"fontawesome-popover.min.js","sources":["../src/fontawesome-popover.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Union - JS code which shows all fontawesome icons in a popover.\n *\n * @module     theme_boost_union/fontawesome-popover\n * @copyright  2023 bdecent GmbH <https://bdecent.de>\n * @copyright  based on code from theme_boost\\footer-popover by Bas Brands.\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine(['jquery', 'theme_boost/popover', 'core/fragment'], function($, popover, Fragment) {\n\n    const SELECTORS = {\n        PICKERCONTAINER: '.fontawesome-iconpicker-popover',\n        PICKERCONTENT: '[data-region=\"icons-list\"]',\n    };\n\n    var contextID;\n\n    let pickerIsShown = false;\n\n    var SELECTBOX;\n\n    /**\n     * Get the icon list for popover.\n     *\n     * @returns {String} HTML string\n     * @private\n     */\n    const getIconList = () => {\n        return Fragment.loadFragment('theme_boost_union', 'icons_list', contextID, {});\n    };\n\n    /**\n     * Filter the icons in the list with values which the user entered in the search input.\n     * Given input will contain the text in both aria-value and aria-label.\n     * Ex. \"core:t\\document\" is aria-value and \"fa-document\" is aria-label.\n     *\n     * @param {Element} target\n     */\n    const filterIcons = (target) => {\n        var filter = target.value.toLowerCase();\n        SELECTBOX.value = filter || 0;\n        var ul = document.querySelector('.fontawesome-iconpicker-popover ul.fontawesome-icon-suggestions');\n        if (ul === undefined || ul === null) {\n            return;\n        }\n        var li = ul.querySelectorAll('li');\n\n        for (var i = 0; i < li.length; i++) {\n            var value = li[i].getAttribute('aria-value');\n            var label = li[i].getAttribute('aria-label');\n            if (!value.toLowerCase().includes(filter) && !label.toLowerCase().includes(filter)) {\n                li[i].style.display = \"none\";\n            } else {\n                li[i].style.display = \"inline-block\";\n            }\n        }\n    };\n\n    /**\n     * Creates input element and append the element into the target element's parent node.\n     * User is able to search icons using this input field.\n     *\n     * @param {String} target Element Selector.\n     */\n    const createElements = (target) => {\n\n        var input = document.createElement('input');\n        input.setAttribute('type', 'text');\n        input.classList.add('fontawesome-autocomplete');\n        input.classList.add('form-control');\n        input.setAttribute('name', 'iconsearch');\n\n        if (SELECTBOX.value != '') {\n            input.value = SELECTBOX.querySelector('option[selected]') !== null\n                ? SELECTBOX.querySelector('option[selected]').text : '';\n        }\n\n        var wrapper = document.createElement('div');\n        wrapper.classList.add(\"fontawesome-picker-container\");\n        wrapper.append(input);\n\n        document.querySelector(target).style.display = 'none';\n        document.querySelector(target).parentNode.append(wrapper);\n    };\n\n    /**\n     * Update the target with fontawesome iconpicker.\n     *\n     * Create picker input field for search icons insert to DOM, fetch the icons list and setup the popover with icons content.\n     * Display the popover when the icon search input field is focused or clicked. This way user can view the list of icons and\n     * search icons. When the icon is selected, same icon in the select element will be selected.\n     *\n     * @param {String} target Element Selector.\n     */\n    const iconPicker = (target) => {\n\n        SELECTBOX = document.querySelector(target);\n\n        if (SELECTBOX === undefined || SELECTBOX === null) {\n            return;\n        }\n\n        // Create input element and insert for search icons and hide the current target select box.\n        createElements(target);\n\n        // Parent of the target element.\n        var selectBoxParent = document.querySelector(target).parentNode;\n\n        // Input element for search icons, appended in createElements method.\n        const pickerInput = selectBoxParent.querySelector(\"input.fontawesome-autocomplete\");\n\n        // Check the search input created and inserted in DOM.\n        if (pickerInput === undefined || pickerInput === null) {\n            setTimeout(() => iconPicker(target), 1000);\n            return;\n        }\n\n        // Fetch the icons list and setup popover with icons list.\n        getIconList().then(function(html) {\n\n            $(pickerInput).popover({\n                content: html,\n                html: true,\n                placement: 'bottom',\n                customClass: 'fontawesome-picker',\n                trigger: 'click'\n            });\n\n            // Event observer when the popover is inserted in DOM, create event listner for each icon in icons list.\n            // Icon is clicked, set the icon aria-value as value for select box.\n            // Set the icon label to value of autocomplete picker.\n            $(pickerInput).on('inserted.bs.popover', function() {\n                var ul = document.querySelector('.fontawesome-iconpicker-popover ul.fontawesome-icon-suggestions');\n                ul.querySelectorAll('li').forEach((li) => {\n                    li.addEventListener('click', (e) => {\n                        var target = e.target.closest('li');\n                        var value = target.getAttribute('aria-value');\n                        var label = target.getAttribute('aria-label');\n                        pickerInput.value = label;\n                        SELECTBOX.value = value || 0;\n                        $(pickerInput).popover('hide');\n                    });\n                });\n            });\n            return;\n        }).catch();\n\n        document.addEventListener('click', e => {\n            if (pickerIsShown && !e.target.closest(SELECTORS.PICKERCONTAINER)) {\n                $(pickerInput).popover('hide');\n            }\n        },\n        true);\n\n        document.addEventListener('keydown', e => {\n            if (pickerIsShown && e.key === 'Escape') {\n                $(pickerInput).popover('hide');\n                pickerInput.focus();\n            }\n        });\n\n        document.addEventListener('focus', e => {\n            if (pickerIsShown && !e.target.closest(SELECTORS.PICKERCONTAINER)) {\n                $(pickerInput).popover('hide');\n            }\n        },\n        true);\n\n        $(pickerInput).on('shown.bs.popover', () => {\n            pickerIsShown = true;\n            // Add class to selected icon, helps to differentiate.\n            if (pickerInput.value != '') {\n                var iconSuggestion = document.querySelector('.fontawesome-iconpicker-popover ul.fontawesome-icon-suggestions');\n                if (iconSuggestion.querySelector('li[aria-label=\"' + pickerInput.value + '\"]') !== null) {\n                    // Remove selected class.\n                    iconSuggestion.querySelectorAll('li').forEach((li) =>\n                            li.classList.remove('selected'));\n                    // Assign selected class for new.\n                    iconSuggestion.querySelector('li[aria-label=\"' + pickerInput.value + '\"]').classList.add('selected');\n                }\n            }\n        });\n\n        $(pickerInput).on('hide.bs.popover', () => {\n            pickerIsShown = false;\n        });\n\n        pickerInput.addEventListener('keyup', function(e) {\n            filterIcons(e.target);\n        });\n\n    };\n\n    return {\n        init: (target, contextid) => {\n            contextID = contextid;\n            iconPicker(target);\n        }\n\n    };\n});\n"],"names":["define","$","popover","Fragment","SELECTORS","contextID","pickerIsShown","SELECTBOX","iconPicker","target","document","querySelector","input","createElement","setAttribute","classList","add","value","text","wrapper","append","style","display","parentNode","createElements","pickerInput","loadFragment","then","html","content","placement","customClass","trigger","on","querySelectorAll","forEach","li","addEventListener","e","closest","getAttribute","label","catch","key","focus","iconSuggestion","remove","filter","toLowerCase","ul","i","length","includes","filterIcons","setTimeout","init","contextid"],"mappings":";;;;;;;;AAwBAA,+CAAO,CAAC,SAAU,sBAAuB,kBAAkB,SAASC,EAAGC,QAASC,gBAEtEC,0BACe,sCAIjBC,cAEAC,eAAgB,MAEhBC,gBA2EEC,WAAcC,YAIZF,OAFJA,UAAYG,SAASC,cAAcF,gBAhCfA,CAAAA,aAEhBG,MAAQF,SAASG,cAAc,SACnCD,MAAME,aAAa,OAAQ,QAC3BF,MAAMG,UAAUC,IAAI,4BACpBJ,MAAMG,UAAUC,IAAI,gBACpBJ,MAAME,aAAa,OAAQ,cAEJ,IAAnBP,UAAUU,QACVL,MAAMK,MAAwD,OAAhDV,UAAUI,cAAc,oBAChCJ,UAAUI,cAAc,oBAAoBO,KAAO,QAGzDC,QAAUT,SAASG,cAAc,OACrCM,QAAQJ,UAAUC,IAAI,gCACtBG,QAAQC,OAAOR,OAEfF,SAASC,cAAcF,QAAQY,MAAMC,QAAU,OAC/CZ,SAASC,cAAcF,QAAQc,WAAWH,OAAOD,UAqBjDK,CAAef,cAMTgB,YAHgBf,SAASC,cAAcF,QAAQc,WAGjBZ,cAAc,kCAG9Cc,MAAAA,aApFGtB,SAASuB,aAAa,oBAAqB,aAAcrB,UAAW,IA0F7DsB,MAAK,SAASC,MAExB3B,EAAEwB,aAAavB,QAAQ,CACnB2B,QAASD,KACTA,MAAM,EACNE,UAAW,SACXC,YAAa,qBACbC,QAAS,UAMb/B,EAAEwB,aAAaQ,GAAG,uBAAuB,WAC5BvB,SAASC,cAAc,mEAC7BuB,iBAAiB,MAAMC,SAASC,KAC/BA,GAAGC,iBAAiB,SAAUC,QACtB7B,OAAS6B,EAAE7B,OAAO8B,QAAQ,MAC1BtB,MAAQR,OAAO+B,aAAa,cAC5BC,MAAQhC,OAAO+B,aAAa,cAChCf,YAAYR,MAAQwB,MACpBlC,UAAUU,MAAQA,OAAS,EAC3BhB,EAAEwB,aAAavB,QAAQ,oBAKpCwC,QAEHhC,SAAS2B,iBAAiB,SAASC,IAC3BhC,gBAAkBgC,EAAE7B,OAAO8B,QAAQnC,4BACnCH,EAAEwB,aAAavB,QAAQ,WAG/B,GAEAQ,SAAS2B,iBAAiB,WAAWC,IAC7BhC,eAA2B,WAAVgC,EAAEK,MACnB1C,EAAEwB,aAAavB,QAAQ,QACvBuB,YAAYmB,YAIpBlC,SAAS2B,iBAAiB,SAASC,IAC3BhC,gBAAkBgC,EAAE7B,OAAO8B,QAAQnC,4BACnCH,EAAEwB,aAAavB,QAAQ,WAG/B,GAEAD,EAAEwB,aAAaQ,GAAG,oBAAoB,QAClC3B,eAAgB,EAES,IAArBmB,YAAYR,MAAa,KACrB4B,eAAiBnC,SAASC,cAAc,mEACuC,OAA/EkC,eAAelC,cAAc,kBAAoBc,YAAYR,MAAQ,QAErE4B,eAAeX,iBAAiB,MAAMC,SAASC,IACvCA,GAAGrB,UAAU+B,OAAO,cAE5BD,eAAelC,cAAc,kBAAoBc,YAAYR,MAAQ,MAAMF,UAAUC,IAAI,iBAKrGf,EAAEwB,aAAaQ,GAAG,mBAAmB,KACjC3B,eAAgB,KAGpBmB,YAAYY,iBAAiB,SAAS,SAASC,GArJ9B7B,CAAAA,aACbsC,OAAStC,OAAOQ,MAAM+B,cAC1BzC,UAAUU,MAAQ8B,QAAU,MACxBE,GAAKvC,SAASC,cAAc,sEAC5BsC,MAAAA,WAGAb,GAAKa,GAAGf,iBAAiB,MAEpBgB,EAAI,EAAGA,EAAId,GAAGe,OAAQD,IAAK,KAC5BjC,MAAQmB,GAAGc,GAAGV,aAAa,cAC3BC,MAAQL,GAAGc,GAAGV,aAAa,cAC1BvB,MAAM+B,cAAcI,SAASL,SAAYN,MAAMO,cAAcI,SAASL,QAGvEX,GAAGc,GAAG7B,MAAMC,QAAU,eAFtBc,GAAGc,GAAG7B,MAAMC,QAAU,SAyI1B+B,CAAYf,EAAE7B,YA3Ed6C,YAAW,IAAM9C,WAAWC,SAAS,YAgFtC,CACH8C,KAAM,CAAC9C,OAAQ+C,aACXnD,UAAYmD,UACZhD,WAAWC"}