{"version":3,"file":"blockregions.min.js","sources":["../src/blockregions.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Theme Boost Union - JS code to handle block regions alignments.\n *\n * @module     theme_boost_union/blockregions\n * @copyright  2025 bdecent gmbh <https://bdecent.de>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\ndefine([], function() {\n\n    // CSS selectors for the relevant page elements and block regions.\n    const SELECTORS = {\n        outsideLeft: '#theme-block-region-outside-left',\n        outsideRight: '#theme-block-region-outside-right',\n        mainContent: '#page-content',\n        courseContent: '#page-content .course-content',\n        upperRegion: '#theme-block-region-content-upper',\n        alignmentspacerRegion: '.outside-region-alignmentspacer',\n        mainInner: '.main-inner-wrapper',\n        mainPage: '#page',\n    };\n\n    /**\n     * Get the Bootstrap large breakpoint value from CSS custom properties.\n     * Falls back to 992px if the CSS variable is not available.\n     * @returns {number} The large viewport breakpoint in pixels.\n     */\n    const getLargeViewportBreakpoint = function() {\n        // Try to get the Bootstrap --bs-breakpoint-lg CSS custom property.\n        const rootStyles = getComputedStyle(document.documentElement);\n        const bsLgBreakpoint = rootStyles.getPropertyValue('--bs-breakpoint-lg');\n\n        if (bsLgBreakpoint) {\n            // Parse the value (e.g., \"992px\" -> 992).\n            const numericValue = parseInt(bsLgBreakpoint.replace('px', ''), 10);\n            return isNaN(numericValue) ? 992 : numericValue;\n        }\n\n        // Fallback to Bootstrap's default lg breakpoint.\n        return 992;\n    };\n\n    // Calculate the large viewport breakpoint once at module initialization to avoid repeated calculations during resize events.\n    const LARGE_VIEWPORT_BREAKPOINT = getLargeViewportBreakpoint();\n\n    return {\n\n        /**\n         * Initialize the vertical alignment system for outside block regions.\n         * This function manages the visibility and positioning of left and right sidebar regions\n         * to ensure they align properly with the main content area on large viewports.\n         * On smaller viewports, it resets the alignment to let Bootstrap handle the layout.\n         */\n        OutsideRegionsVerticalAlignment: function() {\n\n            /**\n             * If the outside regions vertical alignment is enabled, the 'invisible' class is added on the outside regions\n             * in Mustache. We then need to remove the class to show the outside regions again after they have been vertically\n             * aligned.\n             */\n            const showOutsideRegions = function() {\n                const outsideLeft = document.querySelector(SELECTORS.outsideLeft);\n                const outsideRight = document.querySelector(SELECTORS.outsideRight);\n\n                // Remove Bootstrap's invisible class to make left region visible.\n                if (outsideLeft !== null) {\n                    outsideLeft.classList.remove('invisible');\n                }\n\n                // Remove Bootstrap's invisible class to make right region visible.\n                if (outsideRight !== null) {\n                    outsideRight.classList.remove('invisible');\n                }\n            };\n\n            /**\n             * Calculate and update the vertical alignment of outside block regions.\n             * This function ensures that left and right block regions align properly with the main content\n             * by adjusting alignmentspacer heights based on the difference in vertical positioning.\n             * Vertical alignment is only applied on large viewports.\n             */\n            const updateOutsideRegionsAlignment = function() {\n\n                // Get references to the main page elements.\n                const outsideLeft = document.querySelector(SELECTORS.outsideLeft);\n                const outsideRight = document.querySelector(SELECTORS.outsideRight);\n                const mainPage = document.querySelector(SELECTORS.mainInner) || document.querySelector(SELECTORS.mainPage);\n\n                // Check if we're on a large viewport where vertical alignment should be applied.\n                const isLargeViewport = window.innerWidth >= LARGE_VIEWPORT_BREAKPOINT;\n\n                // If we're on a small viewport, reset alignmentspacer heights and exit.\n                if (!isLargeViewport) {\n                    if (outsideLeft !== null) {\n                        const leftAlignmentspacer = outsideLeft.querySelector(SELECTORS.alignmentspacerRegion);\n                        if (leftAlignmentspacer !== null) {\n                            leftAlignmentspacer.style.height = '0px';\n                        }\n                    }\n                    if (outsideRight !== null) {\n                        const rightAlignmentspacer = outsideRight.querySelector(SELECTORS.alignmentspacerRegion);\n                        if (rightAlignmentspacer !== null) {\n                            rightAlignmentspacer.style.height = '0px';\n                        }\n                    }\n                    return;\n                }\n\n                // Use the upper region add block div as main content if turn editing on.\n                // Use the course content div as main content if it exists, otherwise use the page content div.\n                const mainContent = document.querySelector(SELECTORS.upperRegion) ||\n                    document.querySelector(SELECTORS.courseContent) || document.querySelector(SELECTORS.mainContent);\n\n                // Exit early if no main content is found.\n                if (mainContent === null) {\n                    return;\n                }\n\n                // Calculate dimensions for alignment calculations.\n                const outsideLeftWidth = outsideLeft ? outsideLeft.offsetWidth : 0;\n                const outsideRightWidth = outsideRight ? outsideRight.offsetWidth : 0;\n                const mainContentWidth = mainContent.offsetWidth;\n                const mainPageWidth = mainPage ? mainPage.offsetWidth : 0;\n\n                // Get the top position of the main content for alignment reference.\n                var mainContentTop = mainContent.getBoundingClientRect().top;\n\n                // Handle left region alignment if it exists and has enough space.\n                if (outsideLeft !== null && mainPageWidth >= outsideLeftWidth + mainContentWidth) {\n                    // Find the difference between left region offset top and main content offset top.\n                    // Assign the difference to the height of the alignmentspacer region.\n                    const leftRegionTop = outsideLeft.getBoundingClientRect().top;\n                    const offsetTop = mainContentTop - leftRegionTop;\n                    const leftAlignmentspacer = outsideLeft.querySelector(SELECTORS.alignmentspacerRegion);\n                    if (leftAlignmentspacer !== null) {\n                        // Confirm the left region is inline with the main content.\n                        const isLeftRegionInline = (mainPageWidth >= outsideLeftWidth + mainContentWidth);\n                        // Set alignmentspacer height to create proper vertical alignment.\n                        leftAlignmentspacer.style.height = isLeftRegionInline ? offsetTop + 'px' : 0;\n                    }\n                }\n\n                // Handle right region alignment if it exists.\n                if (outsideRight !== null) {\n\n                    // Find the difference between right region offset top and main content offset top.\n                    // Assign the difference to the height of the alignmentspacer region.\n                    const rightRegionTop = outsideRight.getBoundingClientRect().top;\n                    const offsetTop = mainContentTop - rightRegionTop;\n                    const rightAlignmentspacer = outsideRight.querySelector(SELECTORS.alignmentspacerRegion);\n                    if (rightAlignmentspacer !== null) {\n                        // Confirm the Right region is inline with the main content.\n                        const isRightRegionInline = mainPageWidth >= (outsideRightWidth + mainContentWidth + outsideLeftWidth);\n                        // Set alignmentspacer height to create proper vertical alignment\n                        rightAlignmentspacer.style.height = isRightRegionInline ? offsetTop + 'px' : 0;\n                    }\n                }\n            };\n\n            // Set up event listener for window resize to maintain proper alignment behavior.\n            // This ensures that alignment is applied/removed when switching between viewport sizes.\n            window.addEventListener('resize', updateOutsideRegionsAlignment);\n\n            // Perform initial alignment calculation when the module is loaded.\n            updateOutsideRegionsAlignment();\n\n            // Make the outside regions visible by removing the invisible class.\n            showOutsideRegions();\n        }\n    };\n});\n"],"names":["define","SELECTORS","LARGE_VIEWPORT_BREAKPOINT","bsLgBreakpoint","getComputedStyle","document","documentElement","getPropertyValue","numericValue","parseInt","replace","isNaN","getLargeViewportBreakpoint","OutsideRegionsVerticalAlignment","updateOutsideRegionsAlignment","outsideLeft","querySelector","outsideRight","mainPage","window","innerWidth","leftAlignmentspacer","style","height","rightAlignmentspacer","mainContent","outsideLeftWidth","offsetWidth","outsideRightWidth","mainContentWidth","mainPageWidth","mainContentTop","getBoundingClientRect","top","offsetTop","isLeftRegionInline","isRightRegionInline","addEventListener","classList","remove","showOutsideRegions"],"mappings":";;;;;;;AAuBAA,wCAAO,IAAI,iBAGDC,sBACW,mCADXA,uBAEY,oCAFZA,sBAGW,gBAHXA,wBAIa,gCAJbA,sBAKW,oCALXA,gCAMqB,kCANrBA,oBAOS,sBAPTA,mBAQQ,QAwBRC,0BAhB6B,iBAGzBC,eADaC,iBAAiBC,SAASC,iBACXC,iBAAiB,yBAE/CJ,eAAgB,OAEVK,aAAeC,SAASN,eAAeO,QAAQ,KAAM,IAAK,WACzDC,MAAMH,cAAgB,IAAMA,oBAIhC,IAIuBI,SAE3B,CAQHC,gCAAiC,iBA4BvBC,8BAAgC,iBAG5BC,YAAcV,SAASW,cAAcf,uBACrCgB,aAAeZ,SAASW,cAAcf,wBACtCiB,SAAWb,SAASW,cAAcf,sBAAwBI,SAASW,cAAcf,yBAG/DkB,OAAOC,YAAclB,2BAGvB,IACE,OAAhBa,YAAsB,OAChBM,oBAAsBN,YAAYC,cAAcf,iCAC1B,OAAxBoB,sBACAA,oBAAoBC,MAAMC,OAAS,UAGtB,OAAjBN,aAAuB,OACjBO,qBAAuBP,aAAaD,cAAcf,iCAC3B,OAAzBuB,uBACAA,qBAAqBF,MAAMC,OAAS,oBAQ1CE,YAAcpB,SAASW,cAAcf,wBACvCI,SAASW,cAAcf,0BAA4BI,SAASW,cAAcf,0BAG1D,OAAhBwB,yBAKEC,iBAAmBX,YAAcA,YAAYY,YAAc,EAC3DC,kBAAoBX,aAAeA,aAAaU,YAAc,EAC9DE,iBAAmBJ,YAAYE,YAC/BG,cAAgBZ,SAAWA,SAASS,YAAc,MAGpDI,eAAiBN,YAAYO,wBAAwBC,OAGrC,OAAhBlB,aAAwBe,eAAiBJ,iBAAmBG,iBAAkB,OAIxEK,UAAYH,eADIhB,YAAYiB,wBAAwBC,IAEpDZ,oBAAsBN,YAAYC,cAAcf,oCAC1B,OAAxBoB,oBAA8B,OAExBc,mBAAsBL,eAAiBJ,iBAAmBG,iBAEhER,oBAAoBC,MAAMC,OAASY,mBAAqBD,UAAY,KAAO,MAK9D,OAAjBjB,aAAuB,OAKjBiB,UAAYH,eADKd,aAAae,wBAAwBC,IAEtDT,qBAAuBP,aAAaD,cAAcf,oCAC3B,OAAzBuB,qBAA+B,OAEzBY,oBAAsBN,eAAkBF,kBAAoBC,iBAAmBH,iBAErFF,qBAAqBF,MAAMC,OAASa,oBAAsBF,UAAY,KAAO,KAOzFf,OAAOkB,iBAAiB,SAAUvB,+BAGlCA,gCAxG2B,iBACjBC,YAAcV,SAASW,cAAcf,uBACrCgB,aAAeZ,SAASW,cAAcf,wBAGxB,OAAhBc,aACAA,YAAYuB,UAAUC,OAAO,aAIZ,OAAjBtB,cACAA,aAAaqB,UAAUC,OAAO,aAgGtCC"}